# 树状数组

### 树状数组的提出

有四种数组处理问题：单点修改，单点查询；单点修改，区间查询；区间修改，单点查询；区间修改，区间查询。

对普通的数组进行区间求和我们可以用前缀和数组，进行区间修改（指在数组某一段区间上加或减一个值）我们可以用差分数组。但是像上述四种将查询与修改结合起来的情况，我们不得不舍弃这两种方式，因为前缀和数组的更新操作太过复杂，比如更改数组第一个元素，整个前缀和数组都要改；差分数组的查询操作太过复杂，比如查询最后一个值，我们需要将整个差分数组进行相加。

于是树状数组横空出世，给我们带来修改与查询结合情况下的新思路。

要注意的是，原汁原味的树状数组能够做到的是单点修改和区间查询，如果要做到区间修改的话，只需要加一点数学上的处理即可，代码是一样的。



### 树状数组的性质（可跳过直接看代码）

下图中，$a$是原数组，$c$是树状数组

![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfEAAADtCAYAAACvUUwpAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAACocSURBVHhe7d0JuFVT/wfwNypTSigilSKJKLNopITKmKgQmaKJFIkGY6QkY5RokBQqFTJkKEo0KEUaNCvJEBLy+/+/q7Ve+9333HvPOXs4e6/9/TzPeu7d68zn7LW/e1zrP0JERESxxBAnIiKKKYY4ERFRTDHEiYiIYoohTkREFFMMcSIiophiiBMREcUUQ5yIiCimGOJEREQxxRAnIiKKKYY4ERFRTPke4kWLFpX//Oc/LCwsLCwsLP9fdt11V52Q/gskxH/44Qf56aefWFhYWFhYEl22bNkSzxAnIiJKOoY4ERFRTDHEiYiIYoohTkREFFMMcSIiophiiBMREcUUQ5yIiCimGOJElEf9+vWlUqVK0rt37/8pbdu2/W/BfdDRBP4SUW4wxIkoj5UrV6oQnz59uq5Jbfjw4QxxohxiiBNRSghoBHlhEPi4LxGFjyFOFFEIx8K2hIOGrWzsOvciyJB3Pjf+J0oahjhRxCCMEJz4a/7PlHlsYaUwuI85Np4NPA4hi+dJd8s+XVjBMd8NnhsrHOl8JiKbMMSJIsSEpuEMqnThOZwnoxVU0oH3kM7xcTcEq/O9u6e9wHtxHovHZ8ZJdkRJwxAnihCEHMIuFQQXCm4Pe4sTgZ/pVrQ7+N2fzXyW/D5vQRDgzsfhf+cKAr4fFPMaRLZiiBNFCIIvVUCjzhlShW1FmxArrKQLQegM5MLgvu4t41SfDfdLd4+AE57b+VzuFQRMm9tRn8lnJYoThjhRhKTaJWwCCCGIQDIlP7i/2V1eWElHNkGLx7gvPTOfzbkykM1z4/Plt4JgnhvPaYI80+cnihOGOFGEIPjcIWcCG39xe35b60HA6zj3AKQLj8P7NPAcJtTTCfFatWrJq6++qqdEbrvtNmnfvr2e2vl8Br4XE+rOlRvzXRW0wkMUdwxxoghB+CF0TDGB59yiRD0CKowgTyfAzXt2Mysg5jbn/0Z+IX7jjTfKvHnz9JTIsGHDZPDgwXrq3+/DfD/u5zbvG/fDd+V+XSJbMMSJYgAh5AztbLaOM4XwMyGZHxOSzveWifxC3Cvnc5rAJ7IRQ5woJhBECCT3VmcQ8PxYUTCv5Sx4HygIb+zGznaFAgGOx6azspAp812Z74vIVgxxohhB2GW71ZsJd3AXVMJ4P9mK8nsj8gNDnIiIKKYY4kRERDHFECciIoophjgREVFMMcSJiIhiiiFOREQUUwxxIiKimIpliDdu3JiFhYWFhSVypV69einrgyyxCvGxY8fKSy+9xMLCwsLCktPy1FNPSffu3aVFixZy4oknyn777ad6MTzuuONS3j+oglwMiu8hTkREFLbVq1fLhAkTVJe+zZo1k/Lly0uxYsXk5JNPlhtuuEH69esnRx55pJQuXVreeust/aj4Y4gTEVGsoLteDIV75513yjnnnCPlypWT3XffXU499VS56aabZOjQoTJ37lx9b5FFixbJEUccIW3atJGDDjpI19qBIU5ERJG1fPlyGTdunPTo0UOaNGkiZcuWlT333FNOP/106dSpkxofYMGCBfreeX3yyScq5O+9917p1q2bdOzYUd9iB4Y4ERFFwtKlS9Ux5Ntuu00aNWqkjmHvvffe6mS0Ll26yIgRI2ThwoX63oWbNm2alChRQh599FE1XblyZd9H5Ms1hjgREYVuyZIlMnr0aLn11lulYcOG6lj1PvvsIw0aNJCuXbuq2xYvXqzvnblXXnlFncT23HPPqekPPvhADj30UPW/TRjiREQUKByTHjlypNx8881qfPqSJUuqrewzzzxTnT0+ZswY+frrr/W9vcMudgT4+PHjdY2oXe9YObANQ5yIiHzzxRdfyPPPP69Cs06dOrLXXntJmTJl5KyzzlLHtV9++WVZtmyZvrf/Bg8erF7TfQY6zlafOXOmnrIHQ5yIiLIyb948GTZsmHTo0EFq164te+yxhxx44IHqjPGePXuqXdorVqzQ9w7efffdp17/448/1jU7vf322+rsdBsxxImIqED//POPfPbZZ/Lss89K+/bt1bXXxYsXl4MPPliaNm0qvXr1ktdee01WrVqlHxE+nAxXtWpVteveDdeJYy+AjRjiRET0X3/99ZfMnj1bnn76abnuuutUT2foNrRChQpy3nnnSd++fWXSpEmydu1a/Yjcu/HGG+X444/PdyUCl6VhJcRGDHEiooT6448/1HXUTzzxhLRr1051R4oTwipVqiQXXnih3HPPPTJlyhTZsGGDfkT0XH755epkOQw0ksrkyZOlRo0aeso+DHEiogT4/fff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)

列举出来：

$ c_1 = a_1 $

$c_2=a_1+a_2$

$c_3=a_3$

$c_4=a_1+a_2+a_3+a_4$

$c_5=a_5$

$c_6=a_5+a_6$

$c_7=a_7$

$c_8=a_1+a_2+a_3+a_4+a_5+a_6+a_7+a_8$

观察树状数组的性质，有如下几点：

* 树状数组与原数组等长

* 每个树状数组的元素是若干原数组元素的加和，且这若干的原数组元素是连续的（即每个树状数组元素都是原数组的某一区间和）
* $c_i$ 的最后一个加数一定是 $a_i$

* 当 $i$ 为奇数的时候，$c_i=a_i$ , 当 $i$ 是2的次幂的时候，$c_i=a_1+...+a_i$

* （这点不容易看出来）对于任何 $i$ ,都有$c_i=a_{i-2^k+1}+a_{i-2^k+2}+...+a_i$ ,其中，$k$ 是 $i$ 的二进制表示中从最低位往高位的连续0的数量

  比如，$6=0110$ ,从低位向高位数有1个0，所以$k=1$ 。又比如，$8=1000$ ,从低位向高位数有3个0， 所以 $k=3$

  这里直接给出求 $k$ 的方法：$k=i\&(-i)$。我们将这个 $k$ 称为$lowbit(i)$, 意为 $i$ 低位0的个数。

* $a_i$ 包含于若干个树状数组的元素中，分别是$c_i, c_{i+2^{k_1}},c_{(i+2^{k_1})+2^{k_2}}... $一直到数组最大长度。这里的$k_1$是 $i$ 对应的 $k$, $k_2$ 是$i+2^{k_1}$对应的 $k$ ,以此类推

* 原数组的前 $i$ 项和为 $c_i+c_{i-2^{k_1}}+c_{(i-2^{k_1})-2^{k_2}+...}$，一直到下标为1 。这里的$k_1,k_2$解释同上一条性质



### 树状数组的代码

树状数组在不理解原理的情况下也能使用，因为它的代码实在是太简单了

树状数组有两种基本操作：单点更新，求前 $n$ 项和

```C++
int lowbit(int x)//在下面两种操作里用到的一个临时计算函数
{
    return x & (-x);
}

void update(int x, int k)//实现a[i]+=k
{
    while (x <= n) {
        c[x] += k;
        x += lowbit(x);
    }
}

int getsum(int x)//求前x项和
{
    int ans = 0;
    while (x > 0) {
        ans += c[x];
        x -= lowbit(x);
    }
    return ans;
}
```



### 区间更新，单点查询

上述方法只能实现原数组的单点更新，如果是区间更新的话我们可以采用差分建树，即不用原数组建树，使用差分数组建树。这样我们可以用两次单点更新实现区间更新，使用前 $i$ 项和实现单点查询，十分简单

### 区间更新，区间查询

我们假设 $d$ 是 $a$ 的差分数组。

则 $a$ 的前 $i$ 项和为：

$a_1+a_2+a_3+...+a_i=(d_1)+(d_1+d_2)+(d_1+d_2+d_3)+...+(d_1+d_2+d_3+..+d_i)=n(d_1+d_2+...+d_i)-(0d_1+1d_2+2d_3+...(i-1)d_i)$ 

所以我们建两个树状数组，一个是差分建树，另一个用$(i-1)d_i$建树即可。
